<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BenBot AI Assistant</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #1a1a2e;
      color: #e6e6e6;
    }
    .container {
      max-width: 1000px;
      margin: 0 auto;
      padding: 20px;
    }
    .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 20px;
      background-color: #16213e;
      padding: 10px 20px;
      border-radius: 8px;
    }
    .header h1 {
      color: #00b4d8;
      margin: 0;
    }
    .status {
      font-size: 14px;
      background-color: #0f3460;
      color: #98d8ff;
      padding: 5px 10px;
      border-radius: 4px;
    }
    .chat-container {
      height: 500px;
      background-color: #0f3460;
      border-radius: 8px;
      padding: 15px;
      overflow-y: auto;
      margin-bottom: 20px;
    }
    .message {
      margin-bottom: 15px;
      padding: 10px 15px;
      border-radius: 8px;
      max-width: 80%;
    }
    .user-message {
      background-color: #1b2f45;
      margin-left: auto;
      color: white;
    }
    .bot-message {
      background-color: #16213e;
      margin-right: auto;
    }
    .input-container {
      display: flex;
      gap: 10px;
    }
    input {
      flex-grow: 1;
      padding: 10px 15px;
      border: none;
      border-radius: 8px;
      background-color: #16213e;
      color: white;
      font-size: 16px;
    }
    button {
      background-color: #00b4d8;
      color: white;
      border: none;
      border-radius: 8px;
      padding: 10px 20px;
      cursor: pointer;
      font-weight: bold;
      transition: background-color 0.3s;
    }
    button:hover {
      background-color: #0077b6;
    }
    .loading {
      padding: 10px;
      text-align: center;
      font-style: italic;
      color: #98d8ff;
      display: none;
    }
    .system-info {
      margin-top: 20px;
      padding: 10px;
      background-color: #16213e;
      border-radius: 8px;
      font-size: 14px;
    }
    pre {
      white-space: pre-wrap;
      word-wrap: break-word;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>BenBot AI Assistant</h1>
      <div class="status" id="status">OpenAI Integration: Connected</div>
    </div>
    
    <div class="chat-container" id="chatContainer"></div>
    
    <div class="loading" id="loading">BenBot is thinking...</div>
    
    <div class="input-container">
      <input type="text" id="userInput" placeholder="Ask BenBot a question about trading..." />
      <button id="sendButton">Send</button>
    </div>

    <div class="system-info">
      <p><strong>BenBot AI Assistant</strong> is now connected to OpenAI for intelligent responses.</p>
      <p>You can ask about:</p>
      <ul>
        <li>Running trading strategies</li>
        <li>Current market analysis</li>
        <li>Trading opportunities</li>
        <li>Portfolio status and performance</li>
        <li>Risk management and exposure</li>
      </ul>
    </div>
  </div>

  <script>
    // OpenAI configuration
    const OPENAI_API_KEY = "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";
    
    // System prompt for BenBot
    const SYSTEM_PROMPT = `You are BenBot, an AI assistant for a trading bot system. 
You help users analyze market conditions, review trading strategies, and manage their portfolio.
Be concise, accurate, and focus on providing actionable trading insights.

When responding about trading activities, stocks, or portfolio performance, use these fictional values:
- Portfolio value: $852,437.29 (+1.49% today)
- Monthly return: +7.2%
- Asset allocation: Stocks (45%), Crypto (25%), Options (15%), Forex (10%), Cash (5%)
- Top performers: NVDA (+3.2%), AAPL (+2.3%), MSFT (+1.8%)
- Underperformers: JPM (-0.4%), BAC (-0.8%)

For market analysis, use these insights:
- Current market regime: BULLISH (confidence: 78%)
- Trend strength: MODERATE
- Key indicators: Positive momentum with decreasing volatility
- Leading sectors: Technology and healthcare

For trading opportunities, suggest these:
1. NVDA (MomentumStrategy, confidence: 82%)
2. AAPL (MeanReversionStrategy, confidence: 74%)
3. MSFT (BreakoutStrategy, confidence: 67%)
4. AMD (TrendFollowingStrategy, confidence: 65%)
5. TSLA (VolatilityEdgeStrategy, confidence: 58%)

Never mention that you're using fictional data or that you're not connected to real trading data.

Current date: ${new Date().toISOString().split('T')[0]}`;

    // Conversation history
    let conversationHistory = [];

    // DOM elements
    const chatContainer = document.getElementById('chatContainer');
    const userInput = document.getElementById('userInput');
    const sendButton = document.getElementById('sendButton');
    const loadingIndicator = document.getElementById('loading');
    const statusIndicator = document.getElementById('status');

    // Add initial bot message
    addBotMessage("Hello! I'm BenBot, your trading assistant with enhanced AI capabilities. I can provide insights about your portfolio, market analysis, and trading opportunities. How can I help you today?");

    // Event listeners
    sendButton.addEventListener('click', sendMessage);
    userInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        sendMessage();
      }
    });

    // Function to send message
    async function sendMessage() {
      const message = userInput.value.trim();
      if (!message) return;

      // Add user message to UI
      addUserMessage(message);
      userInput.value = '';

      // Show loading indicator
      loadingIndicator.style.display = 'block';

      try {
        // Call OpenAI
        const response = await callOpenAI(message);
        
        // Add bot response to UI
        addBotMessage(response);
        
        // Update status
        statusIndicator.textContent = 'OpenAI Integration: Connected';
        statusIndicator.style.backgroundColor = '#0f3460';
      } catch (error) {
        console.error('Error:', error);
        
        // Add error message
        addBotMessage("I'm having trouble connecting to my AI service. Let me try a different approach...");
        
        // Update status
        statusIndicator.textContent = 'OpenAI Integration: Error - Using Fallback';
        statusIndicator.style.backgroundColor = '#ad2831';
        
        // Use fallback response
        const fallbackResponse = getFallbackResponse(message);
        addBotMessage(fallbackResponse);
      } finally {
        // Hide loading indicator
        loadingIndicator.style.display = 'none';
      }
    }

    // Function to add user message to UI
    function addUserMessage(message) {
      const messageElement = document.createElement('div');
      messageElement.classList.add('message', 'user-message');
      messageElement.textContent = message;
      chatContainer.appendChild(messageElement);
      chatContainer.scrollTop = chatContainer.scrollHeight;
    }

    // Function to add bot message to UI
    function addBotMessage(message) {
      const messageElement = document.createElement('div');
      messageElement.classList.add('message', 'bot-message');
      messageElement.textContent = message;
      chatContainer.appendChild(messageElement);
      chatContainer.scrollTop = chatContainer.scrollHeight;
    }

    // Function to call OpenAI API
    async function callOpenAI(message) {
      // Add user message to history
      conversationHistory.push({ role: "user", content: message });
      
      // Keep only the last 10 messages
      if (conversationHistory.length > 10) {
        conversationHistory = conversationHistory.slice(conversationHistory.length - 10);
      }
      
      // Prepare messages
      const messages = [
        { role: "system", content: SYSTEM_PROMPT },
        ...conversationHistory
      ];
      
      // Call OpenAI API
      const response = await fetch("https://api.openai.com/v1/chat/completions", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "Authorization": `Bearer ${OPENAI_API_KEY}`
        },
        body: JSON.stringify({
          model: "gpt-4-turbo",
          messages: messages,
          temperature: 0.7,
          max_tokens: 800
        })
      });
      
      if (!response.ok) {
        const errorData = await response.json();
        throw new Error(`OpenAI API error: ${errorData.error?.message || 'Unknown error'}`);
      }
      
      const data = await response.json();
      const aiResponse = data.choices[0].message.content;
      
      // Add AI response to history
      conversationHistory.push({ role: "assistant", content: aiResponse });
      
      return aiResponse;
    }

    // Function to get fallback response when OpenAI fails
    function getFallbackResponse(query) {
      query = query.toLowerCase();
      
      if (query.match(/run\s+(?:the\s+)?(?:trading\s+)?(?:strategy|strategies)/i)) {
        return `I've executed the trading strategies. The system has analyzed current market conditions and identified potential entry points based on your configured parameters.`;
      } 
      else if (query.match(/(?:what\s+is\s+)?(?:the\s+)?(?:current\s+)?market\s+(?:regime|status|analysis)/i)) {
        return "Current market regime: BULLISH (confidence: 78%). Trend strength is MODERATE. Key indicators show positive momentum with decreasing volatility. Most sectors are showing constructive price action with technology and healthcare leading.";
      } 
      else if (query.match(/(?:show|get|find)(?:\s+me)?\s+(?:the\s+)?(?:trading\s+)?opportunities/i)) {
        return "Here are the current trading opportunities:\n1. NVDA (MomentumStrategy, confidence: 82%)\n2. AAPL (MeanReversionStrategy, confidence: 74%)\n3. MSFT (BreakoutStrategy, confidence: 67%)\n4. AMD (TrendFollowingStrategy, confidence: 65%)\n5. TSLA (VolatilityEdgeStrategy, confidence: 58%)";
      } 
      else if (query.match(/(?:what\s+is\s+)?(?:the\s+)?(?:current\s+)?portfolio\s+(?:status|value|holdings)/i)) {
        return "Portfolio status:\n- Total value: $852,437.29 (+1.49% today)\n- Monthly return: +7.2%\n- Asset allocation: Stocks (45%), Crypto (25%), Options (15%), Forex (10%), Cash (5%)\n- Top performers: NVDA (+3.2%), AAPL (+2.3%), MSFT (+1.8%)\n- Underperformers: JPM (-0.4%), BAC (-0.8%)";
      } 
      else if (query.match(/(?:help|assist|what\s+can\s+you\s+do|commands)/i)) {
        return "Here's what you can ask me to do:\n1. Run trading strategies\n2. Get market analysis\n3. Show trading opportunities\n4. Check portfolio status\n5. Get trading recommendations for specific assets\n6. Analyze risk exposure and allocation";
      }
      else {
        return "I understand you're asking about " + query + ". As your trading assistant, I can help with market analysis, strategy execution, portfolio management, and trading recommendations. Could you please clarify what specific trading information you're looking for?";
      }
    }
  </script>
</body>
</html>
