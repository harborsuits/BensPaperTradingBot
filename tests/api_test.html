<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trading Dashboard API Test</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 1200px; margin: 0 auto; padding: 20px; }
        h1 { color: #1976d2; }
        button { background: #1976d2; color: white; border: none; padding: 10px 15px; margin: 5px; cursor: pointer; }
        pre { background: #f5f5f5; padding: 15px; border-radius: 5px; overflow: auto; max-height: 400px; }
        .card { border: 1px solid #ddd; border-radius: 8px; padding: 15px; margin-bottom: 20px; }
        .success { color: green; }
        .error { color: red; }
    </style>
</head>
<body>
    <h1>Trading Dashboard API Test</h1>
    <p>This page tests direct connections to your API on port 8765</p>
    
    <div class="card">
        <h2>API Connection</h2>
        <button onclick="testApiRoot()">Test API Root</button>
        <pre id="rootResult">Results will appear here...</pre>
    </div>
    
    <div class="card">
        <h2>Portfolio Data</h2>
        <button onclick="getPortfolio()">Get Portfolio</button>
        <pre id="portfolioResult">Results will appear here...</pre>
    </div>
    
    <div class="card">
        <h2>Strategies</h2>
        <button onclick="getStrategies()">Get Strategies</button>
        <pre id="strategiesResult">Results will appear here...</pre>
    </div>
    
    <div class="card">
        <h2>Trades</h2>
        <button onclick="getTrades()">Get Trades</button>
        <pre id="tradesResult">Results will appear here...</pre>
    </div>
    
    <script>
        const API_BASE_URL = 'http://127.0.0.1:8765';
        
        async function fetchFromApi(endpoint) {
            try {
                const response = await fetch(`${API_BASE_URL}${endpoint}`);
                if (!response.ok) {
                    throw new Error(`API error: ${response.status} ${response.statusText}`);
                }
                return await response.json();
            } catch (error) {
                console.error(`Error fetching from ${endpoint}:`, error);
                throw error;
            }
        }
        
        async function testApiRoot() {
            const resultElement = document.getElementById('rootResult');
            try {
                resultElement.textContent = 'Testing API connection...';
                const data = await fetchFromApi('/');
                resultElement.innerHTML = `<span class="success">Success!</span> API is accessible.\n\n${JSON.stringify(data, null, 2)}`;
            } catch (error) {
                resultElement.innerHTML = `<span class="error">Error:</span> ${error.message}`;
            }
        }
        
        async function getPortfolio() {
            const resultElement = document.getElementById('portfolioResult');
            try {
                resultElement.textContent = 'Fetching portfolio data...';
                const data = await fetchFromApi('/api/portfolio');
                resultElement.innerHTML = `<span class="success">Success!</span> Portfolio data retrieved.\n\n${JSON.stringify(data, null, 2)}`;
            } catch (error) {
                resultElement.innerHTML = `<span class="error">Error:</span> ${error.message}`;
            }
        }
        
        async function getStrategies() {
            const resultElement = document.getElementById('strategiesResult');
            try {
                resultElement.textContent = 'Fetching strategies...';
                const data = await fetchFromApi('/api/strategies');
                resultElement.innerHTML = `<span class="success">Success!</span> Retrieved ${data.length} strategies.\n\n${JSON.stringify(data.slice(0, 3), null, 2)}`;
            } catch (error) {
                resultElement.innerHTML = `<span class="error">Error:</span> ${error.message}`;
            }
        }
        
        async function getTrades() {
            const resultElement = document.getElementById('tradesResult');
            try {
                resultElement.textContent = 'Fetching trade data...';
                const data = await fetchFromApi('/api/trades');
                resultElement.innerHTML = `<span class="success">Success!</span> Retrieved ${data.length} trades.\n\n${JSON.stringify(data.slice(0, 3), null, 2)}`;
            } catch (error) {
                resultElement.innerHTML = `<span class="error">Error:</span> ${error.message}`;
            }
        }
    </script>
</body>
</html>
